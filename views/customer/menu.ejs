<%- include('../layouts/main', { body: `
<!-- Feature 27: Festive fireworks effect on Tet -->
<div id="confetti-container" class="fixed inset-0 pointer-events-none z-50 hidden"></div>

<!-- Feature 30: Marquee announcement -->
<% if (config.theme.marqueeMessage.enabled) { %>
<div class="bg-gradient-to-r from-primary-500 to-secondary-500 text-white py-1.5 overflow-hidden">
  <div class="animate-marquee whitespace-nowrap">
    <span class="mx-4"><%= config.theme.marqueeMessage.message %></span>
    <span class="mx-4"><%= config.theme.marqueeMessage.message %></span>
  </div>
</div>
<style>
  @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .animate-marquee { animation: marquee 20s linear infinite; display: inline-block; }
</style>
<% } %>

<!-- Feature 272: Sticky Header -->
<header class="sticky-header shadow-sm">
  <div class="max-w-7xl mx-auto px-4 py-3">
    <div class="flex items-center justify-between">
      <!-- Logo & Name -->
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg">
          üçú
        </div>
        <div>
          <h1 class="font-display font-bold text-lg text-gray-800 dark:text-white"><%= config.store.name %></h1>
          <p class="text-xs text-gray-500 dark:text-gray-400"><%= greeting %>!</p>
        </div>
      </div>
      
      <!-- Actions -->
      <div class="flex items-center gap-2">
        <!-- Feature 28: Dark mode toggle -->
        <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
          <svg class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/></svg>
          <svg class="w-5 h-5 dark:hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
        </button>
        
        <!-- Feature 43: Floating cart button -->
        <a href="/cart" class="relative p-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors shadow-lg">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
          <span id="cart-badge" class="absolute -top-1 -right-1 w-5 h-5 bg-secondary-500 text-xs font-bold rounded-full flex items-center justify-center hidden">0</span>
        </a>
      </div>
    </div>
    
    <!-- Feature 3: Search bar -->
    <div class="mt-3 relative">
      <input type="text" id="search-input" placeholder="üîç T√¨m m√≥n y√™u th√≠ch..." 
        class="w-full pl-4 pr-10 py-2.5 bg-gray-100 dark:bg-gray-800 rounded-xl border-none focus:ring-2 focus:ring-primary-500 transition-all text-sm">
      <button id="random-btn" class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors" title="M√≥n ng·∫´u nhi√™n">
        üé≤
      </button>
    </div>
  </div>
  
  <!-- Feature 5: Category tabs (horizontal scroll) -->
  <div class="border-t border-gray-100 dark:border-gray-800">
    <div class="flex overflow-x-auto hide-scrollbar gap-1 px-4 py-2">
      <button class="category-tab active flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-all bg-primary-500 text-white" data-category="all">
        T·∫•t c·∫£
      </button>
      <% categories.forEach(cat => { %>
      <button class="category-tab flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700" data-category="<%= cat.slug %>">
        <%= cat.icon %> <%= cat.name %>
      </button>
      <% }); %>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 py-4 pb-24">
  <!-- Feature 2: Best Sellers Banner -->
  <% if (bestSellers.length > 0) { %>
  <section class="mb-6">
    <h2 class="font-display font-bold text-lg mb-3 flex items-center gap-2">
      üî• B√°n Ch·∫°y
    </h2>
    <div class="flex overflow-x-auto hide-scrollbar gap-3 -mx-4 px-4">
      <% bestSellers.forEach(product => { %>
      <div class="flex-shrink-0 w-36 bg-white dark:bg-gray-800 rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-lg transition-all product-card" data-id="<%= product._id %>">
        <div class="relative aspect-square">
          <img src="<%= product.images[0]?.url || '/images/placeholder.jpg' %>" alt="<%= product.name %>" 
            class="w-full h-full object-cover" loading="lazy">
          <% if (product.discountPercent > 0) { %>
          <span class="absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">
            -<%= product.discountPercent %>%
          </span>
          <% } %>
        </div>
        <div class="p-2">
          <h3 class="font-medium text-sm truncate"><%= product.name %></h3>
          <div class="flex items-baseline gap-1 mt-1">
            <span class="text-primary-500 font-bold text-sm"><%= formatCurrency(product.price) %></span>
            <% if (product.originalPrice) { %>
            <span class="text-gray-400 text-xs line-through"><%= formatCurrency(product.originalPrice) %></span>
            <% } %>
          </div>
        </div>
      </div>
      <% }); %>
    </div>
  </section>
  <% } %>
  
  <!-- Feature 6: Sort options -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="font-display font-bold text-lg">Th·ª±c ƒë∆°n</h2>
    <select id="sort-select" class="text-sm bg-transparent border-none focus:ring-0 text-gray-600 dark:text-gray-400">
      <option value="default">M·∫∑c ƒë·ªãnh</option>
      <option value="price_asc">Gi√°: Th·∫•p ‚Üí Cao</option>
      <option value="price_desc">Gi√°: Cao ‚Üí Th·∫•p</option>
      <option value="popular">Ph·ªï bi·∫øn nh·∫•t</option>
    </select>
  </div>
  
  <!-- Feature 13-14: Grid/List toggle view -->
  <div id="products-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
    <% products.forEach(product => { %>
    <div class="product-card bg-white dark:bg-gray-800 rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all" 
         data-id="<%= product._id %>"
         data-category="<%= product.category?.slug %>"
         data-name="<%= product.name.toLowerCase() %>"
         data-price="<%= product.price %>">
      <!-- Product Image -->
      <div class="relative aspect-square">
        <img src="<%= product.images[0]?.url || '/images/placeholder.jpg' %>" alt="<%= product.name %>" 
          class="w-full h-full object-cover" loading="lazy">
        
        <!-- Labels -->
        <div class="absolute top-2 left-2 flex flex-col gap-1">
          <% if (product.labels.isNew) { %>
          <span class="bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">M·ªõi</span>
          <% } %>
          <% if (product.labels.isBestSeller) { %>
          <span class="bg-orange-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">Hot</span>
          <% } %>
          <% if (product.labels.isLimitedStock) { %>
          <span class="bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">S·∫Øp h·∫øt</span>
          <% } %>
          <% if (product.labels.isVegetarian) { %>
          <span class="bg-green-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">Chay</span>
          <% } %>
        </div>
        
        <!-- Feature 21: Favorite button -->
        <button class="favorite-btn absolute top-2 right-2 w-8 h-8 bg-white/80 dark:bg-gray-800/80 backdrop-blur rounded-full flex items-center justify-center hover:scale-110 transition-transform" data-id="<%= product._id %>">
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
        </button>
        
        <!-- Quick add button -->
        <button class="quick-add-btn absolute bottom-2 right-2 w-8 h-8 bg-primary-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-primary-600 hover:scale-110 transition-all ripple" data-id="<%= product._id %>">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
        </button>
      </div>
      
      <!-- Product Info -->
      <div class="p-3">
        <h3 class="font-medium text-sm line-clamp-2 mb-1"><%= product.name %></h3>
        
        <!-- Feature 12: Sold count -->
        <% if (product.inventory.soldCount > 0) { %>
        <p class="text-xs text-gray-400 mb-1">ƒê√£ b√°n <%= product.inventory.soldCount > 1000 ? (product.inventory.soldCount / 1000).toFixed(1) + 'k' : product.inventory.soldCount %></p>
        <% } %>
        
        <!-- Price -->
        <div class="flex items-baseline gap-1">
          <span class="text-primary-500 font-bold"><%= formatCurrency(product.price) %></span>
          <% if (product.originalPrice && product.originalPrice > product.price) { %>
          <span class="text-gray-400 text-xs line-through"><%= formatCurrency(product.originalPrice) %></span>
          <% } %>
        </div>
      </div>
    </div>
    <% }); %>
  </div>
  
  <!-- Empty state -->
  <div id="empty-state" class="hidden text-center py-12">
    <div class="text-6xl mb-4">üçú</div>
    <h3 class="font-medium text-lg mb-2">Kh√¥ng t√¨m th·∫•y m√≥n n√†o</h3>
    <p class="text-gray-500">Th·ª≠ t√¨m v·ªõi t·ª´ kh√≥a kh√°c nh√©!</p>
  </div>
</main>

<!-- Feature 15: Product detail modal -->
<div id="product-modal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="modal-backdrop"></div>
  <div class="absolute inset-x-4 bottom-0 max-h-[90vh] bg-white dark:bg-gray-800 rounded-t-3xl overflow-hidden transform transition-transform" id="modal-content">
    <div class="overflow-y-auto max-h-[85vh]" id="modal-body">
      <!-- Dynamic content loaded here -->
    </div>
  </div>
</div>

<!-- Feature 43: Floating cart summary -->
<div id="cart-summary" class="fixed bottom-4 left-4 right-4 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-2xl shadow-2xl p-4 z-40 hidden">
  <a href="/cart" class="flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
      </div>
      <div>
        <p class="text-sm opacity-90"><span id="cart-count">0</span> m√≥n</p>
        <p class="font-bold" id="cart-total">0 ƒë</p>
      </div>
    </div>
    <div class="bg-white text-primary-500 font-bold px-4 py-2 rounded-xl">
      ƒê·∫∑t h√†ng
    </div>
  </a>
</div>

<!-- Feature 277: QR Footer -->
<footer class="bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 py-6 mt-8">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
      <%= config.store.slogan %>
    </p>
    <p class="text-xs text-gray-400">
      <!-- Feature 300: Credits -->
      Made with ‚ù§Ô∏è by <%= config.credits.teamName %> | v<%= appVersion %>
    </p>
    <% if (config.store.hotline) { %>
    <!-- Feature 201: Emergency contact -->
    <a href="tel:<%= config.store.hotline %>" class="inline-flex items-center gap-1 mt-2 text-primary-500 text-sm">
      üìû Hotline: <%= config.store.hotline %>
    </a>
    <% } %>
  </div>
</footer>

<script>
  // Product data for client-side operations
  window.productsData = ${JSON.stringify(products.map(p => ({
    _id: p._id,
    name: p.name,
    price: p.price,
    originalPrice: p.originalPrice,
    images: p.images,
    category: p.category?.slug,
    sizes: p.sizes,
    toppings: p.toppings,
    customizations: p.customizations,
    requiredOptions: p.requiredOptions,
    description: p.description
  })))};
</script>
<script src="/js/customer.js"></script>
` }) %>
